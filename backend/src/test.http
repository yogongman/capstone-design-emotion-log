### 공통 변수 설정
@baseUrl = http://localhost:8080/api/v1
@contentType = application/json

# ==========================================
# 1. 기록 저장 (Create) - POST /records
# ==========================================
POST {{baseUrl}}/records
Content-Type: {{contentType}}

{
  "emotionType": "joy",
  "level": 90,
  "reason": "테스트 일기 저장입니다. 기분이 아주 좋아요!",
  "recordedAt": "2025-11-27T14:00:00"
}

###

# ==========================================
# 2. 기록 수정 (Update) - PATCH /records/{recordId}
# ==========================================
# [주의] 아래 변수에 수정할 실제 Record ID를 넣으세요.
@recordIdToUpdate = 13

PATCH {{baseUrl}}/records/{{recordIdToUpdate}}
Content-Type: {{contentType}}

{
  "emotionType": "sadness",
  "level": 40,
  "reason": "수정된 내용입니다. 사실 조금 슬퍼졌어요."
}

###

# ==========================================
# 3. 기록 삭제 (Delete) - DELETE /records/{recordId}
# ==========================================
# [주의] 아래 변수에 삭제할 실제 Record ID를 넣으세요.
@recordIdToDelete =14

DELETE {{baseUrl}}/records/{{recordIdToDelete}}
Content-Type: {{contentType}}

###

# ==========================================
# 4. 조회 (월간/일간/최근)
# ==========================================

# 월간 기록 조회
GET {{baseUrl}}/records/monthly?year=2025&month=11
Content-Type: {{contentType}}

###

# 일간 기록 조회
GET {{baseUrl}}/records/daily?date=2025-11-28
Content-Type: {{contentType}}

###

# 최근 기록 조회
GET {{baseUrl}}/records/recent
Content-Type: {{contentType}}


### =================================================================
### [Step 1] AI 학습 데이터 빌드업 (과거 데이터 쌓기)
### =================================================================

### 5-1. [과거 일기 A] 작성 (상황: 시험 망침)
# 응답에서 "id" 값을 확인하세요. (예: 10)
POST {{baseUrl}}/records
Content-Type: {{contentType}}

{
  "emotionType": "depressed",
  "level": 80,
  "reason": "열심히 준비한 시험인데 너무 긴장해서 다 망쳤어. 나는 왜 이럴까.",
  "recordedAt": "2025-11-01T10:00:00"
}

### 5-2. [과거 일기 A] 솔루션 생성 요청
# [주의] 위에서 받은 ID를 아래 URL에 넣으세요.
@recordId_A = 13

POST {{baseUrl}}/solutions/generate
Content-Type: {{contentType}}

{
  "recordId": {{recordId_A}}
}

### 5-3. [과거 일기 A] 평가 - "아주 좋음(5점)"
# [주의] 위 솔루션 생성 응답에서 받은 solutionId를 URL에 넣으세요.
@solutionId_A = 4

POST {{baseUrl}}/solutions/{{solutionId_A}}/feedback
Content-Type: {{contentType}}

{
  "score": 5
}


### 6-1. [과거 일기 B] 작성 (상황: 면접 망침)
# 응답에서 "id" 값을 확인하세요. (예: 11)
POST {{baseUrl}}/records
Content-Type: {{contentType}}

{
  "emotionType": "depressed",
  "level": 90,
  "reason": "면접관 앞에서 말 한마디도 제대로 못 했어. 너무 한심해.",
  "recordedAt": "2025-11-05T14:00:00"
}

### 6-2. [과거 일기 B] 솔루션 생성 요청
# [주의] 위에서 받은 ID를 아래 변수에 넣으세요.
@recordId_B = 14

POST {{baseUrl}}/solutions/generate
Content-Type: {{contentType}}

{
  "recordId": {{recordId_B}}
}

### 6-3. [과거 일기 B] 평가 - "아주 싫음(1점)"
# [주의] 위 솔루션 생성 응답에서 받은 solutionId를 URL에 넣으세요.
@solutionId_B = 5

POST {{baseUrl}}/solutions/{{solutionId_B}}/feedback
Content-Type: {{contentType}}

{
  "score": 1
}


### =================================================================
### [Step 2] RAG 성능 테스트 (학습 결과 확인)
### =================================================================

### 7-1. [현재 일기] 작성 (비슷한 상황: 발표 망침)
# 기대: AI가 A(시험)의 조언 스타일은 따라하고, B(면접) 스타일은 피해야 함.
POST {{baseUrl}}/records
Content-Type: {{contentType}}

{
  "emotionType": "depressed",
  "level": 85,
  "reason": "프로젝트 발표를 망쳤어. 팀원들한테 너무 미안하고 쥐구멍에 숨고 싶다.",
  "recordedAt": "2025-11-28T18:00:00"
}

### 7-2. [현재 일기] 솔루션 요청 (검증 단계)
# [주의] 위에서 생성된 현재 일기의 ID를 넣으세요.
@recordId_Current = 15

POST {{baseUrl}}/solutions/generate
Content-Type: {{contentType}}

{
  "recordId": {{recordId_Current}}
}

### 7-3. [현재 일기] 결과 평가
# 응답받은 솔루션 ID를 넣으세요.
@solutionId_Current = 6

POST {{baseUrl}}/solutions/{{solutionId_Current}}/feedback
Content-Type: {{contentType}}

{
  "score": 5
}

### 1. 구글 로그인 시도 (신규 유저 토큰 발급 요청)
# 백엔드가 "Base64 디코딩"을 수행하므로, 형식을 갖춘 가짜 토큰을 보냅니다.
# Payload: {"email": "http_test_user@gmail.com", "sub": "99999"}
POST {{host}}/api/v1/auth/login/google
Content-Type: {{contentType}}

{
  "token": "header.eyJlbWFpbCI6ICJodHRwX3Rlc3RfdXNlckBdtYWlsLmNvbSIsICJzdWIiOiAiOTk5OTkifQ==.signature"
}

> {%
    // 응답에서 임시 accessToken을 꺼내서 'signupToken' 변수에 저장
    client.global.set("signupToken", response.body.accessToken);
    client.log("Signup Token: " + response.body.accessToken);

    // 신규 유저인지 확인
    client.test("Is New User", function() {
        client.assert(response.body.isNewUser === true, "신규 유저여야 합니다.");
    });
%}


### 2. 회원가입 진행 (위에서 받은 임시 토큰 사용)
# 헤더에 signupToken을 넣고, Body에는 닉네임/나이/성별만 보냅니다.
POST {{host}}/api/v1/auth/signup
Content-Type: {{contentType}}
Authorization: Bearer {{signupToken}}

{
  "nickname": "HTTP클라이언트",
  "age": 20,
  "gender": "male"
}

> {%
    // 응답에서 정식 accessToken을 꺼내서 'realToken' 변수에 저장
    client.global.set("realToken", response.body.accessToken);
    client.log("Real Token: " + response.body.accessToken);

    // 성공 여부 확인
    client.test("Signup Success", function() {
        client.assert(response.status === 200, "가입이 성공해야 합니다.");
    });
%}


### 3. 내 정보 조회 (검증)
# 정식 토큰으로 요청했을 때, 아까 그 이메일(http_test_user@gmail.com)이 나와야 성공!
GET {{host}}/api/v1/users/me
Authorization: Bearer {{realToken}}

> {%
    client.test("Email Verification", function() {
        var email = response.body.email;
        client.log("User Email: " + email);
        client.assert(email === "http_test_user@gmail.com", "토큰에 숨겨둔 이메일과 일치해야 합니다.");
    });
%}